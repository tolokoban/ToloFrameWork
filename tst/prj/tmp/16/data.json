{"needs":[],"includes":["d:\\Code\\tolokoban\\prj\\node.js\\tfw3\\src\\cls\\WTag.css"],"timestamp":0,"tags":{"def":{"needs":[],"functions":{"fire":{"comment":"*\n         * Fire a \"signal\" up to the parents widgets.\n         * If a slot returns false, the event is fired up to the parents.\n         *\n         * @param signal Name of the signal to trigger.\n         * @param arg Optional argument to sent with this signal.\n         * @param emitter Optional reference to the signal's emitter.\n         * @memberof WTag\n         ","args":["signal","arg","emitter"]},"registerSignal":{"comment":"*\n         * Register a  listener (the  function \"slot\") for  the signal\n         * \"signal\". If  this slot  returns true, the  signal continue\n         * its ascension towards parent widgets.\n         *\n         * @param signal Name of the signal to catch.\n         * @param slot Function to call to process this signal\n         * @memberof WTag\n         * @inner\n         * @memberof WTag\n         ","args":["signal","slot"]},"unregisterSignal":{"comment":"*\n         * Stop listening for the \"signal\".\n         * @memberof WTag\n         ","args":["signal"]},"slot":{"comment":"*\n         * Call the slot mapped to the \"signal\".\n         * @param signal : name of the signal on which this object may be registred.\n         * @param arg : argument to pass to the registred slot.\n         * @memberof WTag\n         ","args":["signal","arg"]},"parentElement":{"comment":"*\n         * Get the parent element.\n         * @memberof WTag\n         ","args":[]},"parentWidget":{"comment":"*\n         * Get the parent widget.\n         * @memberof WTag\n         ","args":[]},"lang":{"comment":"*\n         * Return or set the current language.\n         * @memberof WTag\n         ","args":["id"]},"findElement":{"comment":"*\n         * Get  an  element  with   this  `name`  among  this  element's\n         * children.\n         * @memberof WTag\n         ","args":["name"]},"findWidget":{"comment":"*\n         * Get the widget  mapped to the element with  this `name` among\n         * this element's children.\n         * @memberof WTag\n         ","args":["name"]},"findDataBinding":{"comment":"*\n         * @description\n         * Databindings are scoped and stored in the `$data` property of a DOM element.\n         * We always take data from the nearest parent element.\n         *\n         * @param {string} name name of the data binding.\n         * @return  object representing  data bindings.  The key  is the\n         * name of  the data and the  value is a two-items  array. First\n         * item is the current value for this data, and second item is a\n         * list of all listeners.\n         * @memberof WTag\n         ","args":["name"]},"data":{"comment":"*\n         * Set/Get bindable data.\n         * @memberof WTag\n         ","args":["name","value"]},"fireData":{"comment":"*\n         * @description\n         * Simulate a data change.\n         * @param {string|object} name name of the data, or the data binding object itself.\n         * @memberof WTag\n         ","args":["name"]},"defineLocalData":{"comment":"*\n         * @description\n         *\n         * @param name, value\n         * @memberof WTag\n         ","args":["name","value"]},"bindData":{"comment":"*\n         * Bind to data updates.\n         * When the data changed, \n         * @memberof WTag\n         ","args":["name"]},"unbindData":{"comment":"*\n         * @description\n         *\n         * @param name\n         * @memberof WTag\n         ","args":["name"]},"onDataChanged":{"comment":"*\n         * \n         * @memberof WTag\n         ","args":["name","value"]}},"comment":"*\n * @namespace WTag\n * @class WTag\n *\n * Tous les générateurs  de wtags héritent de cette  classe qui contient\n * des fonctions utiles communes.\n ","name":"WTag","init":"*\n     * @constructor\n     "},"zip":"window[\"TFW::WTag\"]={classInit:function(t){t.globalSlots={},window.WTag||(window.WTag={}),$replace=function(t,e){t=$(t),\"string\"==typeof e&&(e=document.createTextNode(e));var n=t.parentNode;return n.replaceChild(e,t),e},$tag=function(t,e){void 0===e&&(e={}),void 0===t&&(t=\"div\");var n,a,i,r=document.createElement(t);for(n in e)a=e[n],r.setAttribute(n,a);for(i=2;i<arguments.length;i++)$addClass(r,arguments[i]);return r},$div=function(t){return $tag(\"div\",t)},$add=function(t,e){$(t).appendChild($(e))},$moveContent=function(t,e){var n,a=[];if(!t)return null;for(t=$(t),e=$(e),n=0;n<t.childNodes.length;n++)a.push(t.childNodes[n]);return a.forEach(function(n){t.removeChild(n),e.appendChild(n)}),e},$copyAttribs=function(t,e){var n,a;for(t=$(t),e=$(e),n=0;n<t.attributes.length;n++)a=t.attributes[n],e.setAttribute(a.name,a.value);return e},$events=function(t,e){t=$(t);var n=function(){e.touchstart&&e.touchstart({target:t})},a=function(n){n.preventDefault(),e.touchend&&e.touchend({target:t}),e.tap&&e.tap({target:t})};return e._type=null,t.addEventListener(\"touchstart\",function(t){e._type||(e._type=\"T\",n(t))}),t.addEventListener(\"mousedown\",function(t){e._type||(e._type=\"M\",n(t))}),t.addEventListener(\"touchend\",function(t){\"T\"==e._type&&a(t),delete e._type}),t.addEventListener(\"mouseup\",function(t){\"M\"==e._type&&a(t),delete e._type}),t},$toggleClass=function(t){var e,n;for(t=$(t),e=0;e<arguments.length;e++)n=arguments[e],$hasClass(n)?$removeClass(n):$addClass(n)},$hasClass=function(t,e){var n,a;return t?(t=$(t),(n=t.className)?(a=new RegExp(\"(\\\\s|^)\"+e+\"(\\\\s|$)\"),n.match(a)?!0:!1):!1):!1},$addClass=function(t){var e,n;if(t)for(t=$(t),e=1;e<arguments.length;e++)n=arguments[e],t.className?$hasClass(t,n)||(t.className+=\" \"+n):t.className=n},$removeClass=function(t){var e,n,a;if(!t)return this;for(t=$(t),n=1;n<arguments.length;n++)a=arguments[n],$hasClass(t,a)&&(e=new RegExp(\"(\\\\s|^)\"+a+\"(\\\\s|$)\"),t.className=t.className.replace(e,\" \"))},$show=function(t){$removeClass(t,\"wtag-hidden\",\"wtag-hidden2\",\"wtag-hidden3\")},$hide=function(t){$addClass(t,\"wtag-hidden\",\"wtag-hidden2\",\"wtag-hidden3\")},$clear=function(t){$(t).innerHTML=\"\"},$focus=function(t){t=$(t),setTimeout(function(){\"function\"==typeof t.focus&&t.focus()},100)},$css=function(t,e){t=$(t);var n,a;for(n in e)a=e[n],t.style[n]=a},$=function(t){var e=\"string\"==typeof t?document.querySelector(t):t;if(!e)throw new Error('Bad selector: \"'+t+'\"!');return\"object\"==typeof e&&!e.nodeName&&e._element?e._element:e}},init:function(){var t;if(t=\"object\"==typeof this._id?this._id:document.getElementById(this._id),!t)throw new Error('There is no element with id \"'+this._id+'\"!');t.$widget=this,this._element=t,this._slots={}},functions:{fire:function(t,e,n){var a,i=this;if(\"undefined\"==typeof n&&(n=this),console.log(\"fire(\"+t+\")\",e),\"@\"==t.charAt(0)&&(a=$$.statics(\"WTag\"),a&&(a=a.globalSlots[t],a?a[1].call(a[0],e,t,n):console.error('[WTag.fire] Nothing is binded on global signal \"'+t+'\"!'))),\"$\"==t.charAt(0))this.data(t.substr(1).trim(),e);else{for(;i;){if(a=i._slots[t],\"function\"==typeof a&&!1!==a.call(i,e,t,n))return;i=i.parentWidget()}console.warning(\"Signal lost: \"+t+\"!\")}},registerSignal:function(t,e){\"@\"==t.charAt(0)?$$.statics(\"WTag\").globalSlots[t]=[this,e]:this._slots[t]=e},unregisterSignal:function(t){delete this._slots[t]},slot:function(t,e){var n=this._slots[t];return n?(n.call(this,e,t),!0):!1},parentElement:function(){return this._element.parentNode},parentWidget:function(){for(var t=this._element;t.parentNode;)if(t=t.parentNode,t.$widget)return t.$widget;return null},lang:function(t){if($$.App||($$.App=this),!$$.App._languages){var e=[],n=document.createElement(\"style\"),a=document.querySelectorAll(\"[lang]\");document.head.appendChild(n),$$.App._langStyle=n;for(var i=0;i<a.length;i++){var r=a[i];for(o=r.getAttribute(\"lang\"),d=!1,s=0;s<e.length;s++)if(e[s]==o){d=!0;break}d||e.push(o)}$$.App._languages=e}var o,s,d,l,u;if(e=$$.App._languages,void 0===t)return o=$$.lang(),o||(o=navigator.language||navigator.browserLanguage||\"fr\",o=o.substr(0,2)),$$.lang(o),o;for(d=!1,s=0;s<e.length;s++)if(e[s]==t){d=!0;break}for(d||(t=e[0]),u=\"\",l=!0,s=0;s<e.length;s++)o=e[s],o!=t&&(l?l=!1:u+=\",\",u+=\"[lang=\"+o+\"]\");$$.App._langStyle.textContent=u+\"{display: none}\",$$.lang(t)},findElement:function(t){if(\"undefined\"==typeof t)return this._element;var e=this._element.querySelector(\"[name='\"+t+\"']\");if(!e)throw new Error(\"[WTag.get] Can't find child [name=\\\"\"+t+'\"] in element \"'+this._id+'\"!');return e},findWidget:function(t){if(\"undefined\"==typeof t)return this;var e=this.findElement(t);return e?e.$widget:null},findDataBinding:function(t){for(var e,n,a=this.findElement();a&&(n=a,!(n.$data&&t in n.$data))&&\"html\"!=n.nodeName.toLowerCase();)a=n.parentNode;return e=n.$data[t],\"undefined\"==typeof e&&(e=[\"\",[]],n.$data[t]=e),e},data:function(t,e){var n=this.findDataBinding(t);return\"undefined\"==typeof e?n[0]:void(e!==n[0]&&(n[0]=e,this.fireData(n)))},fireData:function(t){var e=t;\"string\"==typeof t&&(e=this.findDataBinding(t)),e[1].forEach(function(n){n!==this&&n.onDataChanged(t,e[0])})},defineLocalData:function(t,e){var n=this.findElement();this._dataBinding||(n.$data={}),n.$data[t]=[e,[]]},bindData:function(t){var e=this.findDataBinding(t);e[1].push(this)},unbindData:function(t){var e,n,a=this.findDataBinding(t);for(e=0;e<a[1].length;e++)if(n=a[1][e],this===n)return a[1].splice(e,1),!0;return!1},onDataChanged:function(t,e){console.log(\"[WTag.onDataChanged] \"+t+\" := \"+e)}}};"}}